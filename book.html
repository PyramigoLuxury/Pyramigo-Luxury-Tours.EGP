<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tour Booking</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .container { max-width: 900px; margin: auto; padding: 20px; }
    h1, h2 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    .time-btn { padding: 8px 12px; margin: 5px; border: 1px solid #999; border-radius: 4px; cursor: pointer; }
    .time-btn.selected { background: green; color: white; }
    button { padding: 10px 15px; background: green; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .booking-table td { height: 40px; }
    .booked { background-color: #f88; }
    .available { background-color: #8f8; cursor: pointer; }
  </style>
</head>
<body>

<div class="container">
  <h1>Tour Booking</h1>

  <h2>Price Table</h2>
  <table id="priceTable">
    <thead>
      <tr>
        <th>Category</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Subtotal</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Adult</td>
        <td data-price="50">50</td>
        <td>
          <select class="qty" onchange="updateSubtotal()">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
          </select>
        </td>
        <td class="subtotal">USD 0</td>
      </tr>
      <tr>
        <td>Child</td>
        <td data-price="25">25</td>
        <td>
          <select class="qty" onchange="updateSubtotal()">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
          </select>
        </td>
        <td class="subtotal">USD 0</td>
      </tr>
    </tbody>
  </table>
  <p><strong>Total: </strong><span id="totalPrice">USD 0</span></p>

  <h2>Select Time</h2>
  <div>
    <span class="time-btn" onclick="selectTime(this)">8:00 AM</span>
    <span class="time-btn" onclick="selectTime(this)">10:00 AM</span>
    <span class="time-btn" onclick="selectTime(this)">2:00 PM</span>
  </div>
  <input type="hidden" id="tour-time">

  <h2>Booking Slots</h2>
  <table class="booking-table">
    <tr>
      <th>Time</th>
      <th>Status</th>
    </tr>
    <tr>
      <td>8:00 AM</td>
      <td class="available" onclick="selectTimeSlot('8:00 AM')">Available</td>
    </tr>
    <tr>
      <td>10:00 AM</td>
      <td class="booked">Booked</td>
    </tr>
    <tr>
      <td>2:00 PM</td>
      <td class="available" onclick="selectTimeSlot('2:00 PM')">Available</td>
    </tr>
  </table>

  <h2>Booking Form</h2>
  <form id="bookingForm">
    <label>First Name: <input type="text" id="firstName" required></label><br><br>
    <label>Last Name: <input type="text" id="lastName" required></label><br><br>
    <label>Pickup Location: <input type="text" id="pickup" required></label><br><br>
    <label>Tour Date: <input type="date" id="date" required></label><br><br>
    <label>Your WhatsApp Number: <input type="text" id="whatsappNumber" required></label><br><br>
    <button type="submit">Confirm via WhatsApp</button>
  </form>
</div>

<script>
document.getElementById("date").setAttribute("min", new Date().toISOString().split("T")[0]);

function selectTime(btn) {
  document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  document.getElementById('tour-time').value = btn.innerText;
}

function selectTimeSlot(time) {
  document.getElementById('tour-time').value = time;
  alert("Time selected: " + time);
}

function updateSubtotal() {
  let rows = document.querySelectorAll("#priceTable tbody tr");
  let total = 0;
  rows.forEach(row => {
    const price = parseFloat(row.querySelector("td[data-price]").getAttribute("data-price"));
    const qty = parseInt(row.querySelector(".qty").value);
    const subtotal = price * qty;
    row.querySelector(".subtotal").textContent = "USD " + subtotal;
    total += subtotal;
  });
  document.getElementById("totalPrice").textContent = "USD " + total;
}

document.getElementById("bookingForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const firstName = document.getElementById("firstName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const pickup = document.getElementById("pickup").value.trim();
  const date = document.getElementById("date").value;
  const customerNumber = document.getElementById("whatsappNumber").value.trim();
  const time = document.getElementById("tour-time").value;
  const total = document.getElementById("totalPrice").textContent;

  if (!time) return alert("⚠️ Please select a tour time.");
  if (!/^\d{6,15}$/.test(customerNumber)) return alert("⚠️ Invalid WhatsApp number.");

  const message = 
`Tour Booking:
Name: ${firstName} ${lastName}
Pickup: ${pickup}
Date: ${date}
Time: ${time}
Customer WhatsApp: ${customerNumber}
Total Price: ${total}`;

  const encodedMessage = encodeURIComponent(message);
  window.open(`https://wa.me/201283915289?text=${encodedMessage}`, '_blank');
});
</script>

</body>
</html>
